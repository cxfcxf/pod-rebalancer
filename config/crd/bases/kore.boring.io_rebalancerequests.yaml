---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.14.0
  name: rebalancerequests.kore.boring.io
spec:
  group: kore.boring.io
  names:
    kind: RebalanceRequest
    listKind: RebalanceRequestList
    plural: rebalancerequests
    singular: rebalancerequest
    shortNames:
      - rr
      - rebalance
  scope: Namespaced
  versions:
    - additionalPrinterColumns:
        - jsonPath: .status.phase
          name: Phase
          type: string
        - jsonPath: .spec.intervalSeconds
          name: Interval
          type: integer
        - jsonPath: .status.runCount
          name: Runs
          type: integer
        - jsonPath: .status.totalPodsEvicted
          name: Evicted
          type: integer
        - jsonPath: .status.lastRunTime
          name: LastRun
          type: date
        - jsonPath: .metadata.creationTimestamp
          name: Age
          type: date
      name: v1alpha1
      schema:
        openAPIV3Schema:
          description: RebalanceRequest is the Schema for the rebalancerequests API
          properties:
            apiVersion:
              type: string
            kind:
              type: string
            metadata:
              type: object
            spec:
              description: RebalanceRequestSpec defines the desired state of RebalanceRequest
              properties:
                batchIntervalSeconds:
                  default: 30
                  description: BatchIntervalSeconds is the time to wait between batches.
                  minimum: 0
                  format: int32
                  type: integer
                batchSize:
                  default: 5
                  description: BatchSize is the number of pods to evict per batch.
                  minimum: 1
                  format: int32
                  type: integer
                dryRun:
                  default: false
                  description: DryRun if true, will only log what would be evicted.
                  type: boolean
                intervalSeconds:
                  default: 60
                  description: IntervalSeconds sets how often the rebalancer checks and maintains balance.
                  minimum: 30
                  format: int32
                  type: integer
                namespaces:
                  description: Namespaces to target. Empty means all namespaces.
                  items:
                    type: string
                  type: array
                nodeTargets:
                  description: NodeTargets defines per-hardware-type maximum pod counts. Pods are evicted from nodes exceeding their maximum.
                  items:
                    description: NodeTarget defines the maximum number of pods for nodes matching a selector.
                    properties:
                      maxPodsPerNode:
                        description: MaxPodsPerNode is the maximum pods allowed on each node matching this selector.
                        format: int32
                        minimum: 1
                        type: integer
                      nodeSelector:
                        additionalProperties:
                          type: string
                        description: NodeSelector selects nodes by labels.
                        type: object
                    required:
                      - maxPodsPerNode
                    type: object
                  type: array
                selector:
                  description: Selector specifies which pods to consider for rebalancing.
                  properties:
                    matchExpressions:
                      items:
                        properties:
                          key:
                            type: string
                          operator:
                            type: string
                          values:
                            items:
                              type: string
                            type: array
                        required:
                          - key
                          - operator
                        type: object
                      type: array
                    matchLabels:
                      additionalProperties:
                        type: string
                      type: object
                  type: object
                  x-kubernetes-map-type: atomic
              type: object
            status:
              description: RebalanceRequestStatus defines the observed state of RebalanceRequest
              properties:
                conditions:
                  items:
                    properties:
                      lastTransitionTime:
                        format: date-time
                        type: string
                      message:
                        type: string
                      observedGeneration:
                        format: int64
                        type: integer
                      reason:
                        type: string
                      status:
                        type: string
                      type:
                        type: string
                    required:
                      - lastTransitionTime
                      - message
                      - reason
                      - status
                      - type
                    type: object
                  type: array
                lastEvictedCount:
                  description: LastEvictedCount is the number of pods evicted in the last run.
                  format: int32
                  type: integer
                lastRunTime:
                  description: LastRunTime is when the last rebalance check completed.
                  format: date-time
                  type: string
                message:
                  description: Message provides additional information about the current status.
                  type: string
                nextRunTime:
                  description: NextRunTime is when the next rebalance check is scheduled.
                  format: date-time
                  type: string
                phase:
                  default: Pending
                  description: Phase represents the current phase.
                  enum:
                    - Pending
                    - Active
                    - Failed
                  type: string
                runCount:
                  description: RunCount tracks how many times the rebalancer has run.
                  format: int32
                  type: integer
                startTime:
                  description: StartTime is when the rebalancer started.
                  format: date-time
                  type: string
                totalPodsEvicted:
                  description: TotalPodsEvicted is the cumulative number of pods evicted.
                  format: int32
                  type: integer
              type: object
          type: object
      served: true
      storage: true
      subresources:
        status: {}
